#!/bin/bash

#コマンド実行履歴を保存するファイル．bash_profile.shで定義されている変数を利用している
HISTTESTFILE="${HOME}/kadai/${COURSEYEAR}/.log/.java_test_history.${HISTDATE}"

#リポジトリ初期化，コミッターの名前とアドレス登録，gitignore設定
for i in `seq 1 3`
do
  git -C ~/kadai/${COURSEYEAR}/test0${i}/ init 1>> "${HISTTESTFILE}" 2>&1
  git -C ~/kadai/${COURSEYEAR}/test0${i}/ config --local user.name "`/usr/local/bin/oitname`" 1>> "${HISTTESTFILE}" 
  git -C ~/kadai/${COURSEYEAR}/test0${i}/ config --local user.email "`/usr/local/bin/oitname`@st.oit.ac.jp" 1>> "${HISTTESTFILE}" 2>&1
  echo -e "*.class\n.*\n*~\n#*\n*.tbz2" > "$HOME/kadai/${COURSEYEAR}/test0${i}/.gitignore" 2>> "${HISTTESTFILE}"
done

#一定時間ごとに編集履歴を保存
while :; do
    #echo "loop"
  for i in `seq 1 3`
  do
    git -C ~/kadai/${COURSEYEAR}/test0${i}/ add -A 1>/dev/null 2>> "${HISTTESTFILE}"
    git -C ~/kadai/${COURSEYEAR}/test0${i}/ commit -m "`date +%s`" 1>/dev/null 2>> "${HISTTESTFILE}"
  done
  sleep 10
done
